var app=getApp(),extend=require('../../../utils/extend');Page(extend({},{data:{userInfo:{},servicePhoneNumber:'',topay:0,tosend:0,send:0,cartCount:0,isSetShoppingCart:!0},onLoad(){app.getUserInfo(a=>{this.setData({userInfo:a.userInfo})}),this.setData({servicePhoneNumber:app.storage.get('usercenter:dashboard:servicePhoneNumber')}),this.fetchCustomerService(),app.on('show',()=>{this.setShopStatus()})},onShow(){this.fetchBuyerCount(),this.fetchCartCount(),this.setShopStatus(),this.intervalCount=5,this.intervalTimer=setInterval(()=>{console.log('iiiii'),this.intervalCount||(clearInterval(this.intervalTimer),this.intervalTimer=null),this.intervalCount--,this.fetchBuyerCount()},2e3)},onHide(){clearInterval(this.intervalTimer),this.intervalTimer=null},setShopStatus(){app.getShopStatus(a=>{this.setData({isSetShoppingCart:a.is_set_shopping_cart})})},onPullDownRefresh(){this.fetchBuyerCount()},fetchBuyerCount(){app.carmen({api:'kdt.trade.buyer.count/1.0.1/get',success:a=>{var b=c=>99<c?'99+':c;this.setData({topay:b(a.topay),tosend:b(a.tosend),send:b(a.send)})},complete:()=>{wx.stopPullDownRefresh()}})},fetchCartCount(){app.carmen({api:'kdt.trade.cart/1.0.0/count',success:a=>{this.setData({cartCount:+a.data})}})},fetchCustomerService(){app.carmen({api:'weapp.wsc.shop.returnaddress/1.0.0/get',success:a=>{var b='';+a.show_notice_mobile&&(a.notice_phone1&&a.notice_phone2?b=a.notice_phone1+'-'+a.notice_phone2:a.notice_mobile&&(b=a.notice_mobile)),this.setData({servicePhoneNumber:b}),app.storage.set('usercenter:dashboard:servicePhoneNumber',b)}})},handleContactCustomerService(){wx.showModal({title:this.data.servicePhoneNumber,confirmText:'\u547C\u53EB',success:a=>{a.confirm&&wx.makePhoneCall({phoneNumber:this.data.servicePhoneNumber})}})}}));