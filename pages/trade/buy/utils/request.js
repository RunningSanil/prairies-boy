var orderFormat=require('./format.js'),app=getApp();module.exports={fetchOrderData(a,b,c){var d;d=a.order_no?requestShowPay:requestShow,d(a,e=>{b(e)},(e,f)=>{c&&c(e,f)})},validCouponCode(a,b,c){var d=orderFormat.formatCouponCodeData(a);app.carmen({api:'kdt.ump.coupon.take/1.0.0/takecode',data:d,method:'POST',success:e=>{b&&b(e)},fail:e=>{c&&c(e)},complete:()=>{this.isFetching=!1}})},createOrder(a,b,c){var d=orderFormat.formatOrderShowData(a,!0);app.carmen({api:'kdt.trade.bill/1.0.0/create',data:{billContext:JSON.stringify(d)},method:'POST',success:e=>{return 200===e.code?void b(e.data,e):void(c&&c(e.message))},fail:e=>{c&&c(e.msg)}})},payOrder(a,b,c){app.carmen({api:'kdt.trade.bill/1.0.0/pay',data:{billPayParam:JSON.stringify(a)},method:'POST',success:d=>{if(200!==d.code)return void(c&&c(d.message));var e=d.data||{},f=e.payData||{};b(f,d)},fail:d=>{c(d.msg)}})}};function requestShow(a,b,c){var d=orderFormat.formatOrderShowData(a);app.carmen({api:'kdt.trade.bill/1.0.0/show',data:{billContext:JSON.stringify(d)},method:'POST',success:e=>{return 200==e.code?void(b&&b(e)):void c(e.message,e)},fail:e=>{c&&c(e.msg,e)}})}function requestShowPay(a,b,c){var d={orderNo:a.order_no,kdtId:app.getKdtId()};app.carmen({api:'kdt.trade.bill/1.0.0/showPay',data:{billShowPayParam:JSON.stringify(d)},method:'GET',success:e=>{return 200==e.code?void(b&&b(e)):void c(e.message,e)},fail:e=>{c&&c(e.msg,e)}})}