var moneyHelper=require('../../../../utils/money'),orderRequest=require('../utils/request');module.exports={showCouponList(){if(!this.data.order_no){var a=this.data.coupons;a.showCouponList=!0,a.tmp_selected=a.selected,this.setData({coupons:a})}},hideCouponList(){var a=this.data.coupons;a.showCouponList=!1,this.setData({coupons:a})},chooseCoupon(a){var b=a.currentTarget,c=b.dataset,d=c.couponid,f=this.data.coupons;if(f.tmp_selected.id==d)f.tmp_selected={};else{var g={};f.list.forEach(h=>{h.id==d&&(g=h)}),f.tmp_selected=g}this.setData({coupons:f})},confirmCouponChoose(){var a=this.data.coupons;a.selected=a.tmp_selected,a.selected.priceStr=moneyHelper(a.selected.value).toYuan(),a.tmp_selected={},this.setData({coupons:a}),this.hideCouponList(),this.updateOrderPayment()},autoUseCoupon(){var a=this.data.coupons,b=a.list||[],c={};0<b.length&&(c=b[0],c.priceStr=moneyHelper(c.value).toYuan()),this.setData({coupons:Object.assign(a,{selected:c})}),this.updateOrderPayment()},onCouponCodeInput(a){var b=a.detail.value,c=this.data.coupons;c.code=b,this.setData({coupons:c})},onCouponCodeFocus(){var a=this.data.coupons;a.error='',this.setData({coupons:a})},verifyCouponCode(){var a=this.data.coupons,b=a.code;return b?void(this.isFetching||(this.isFetching=!0,orderRequest.validCouponCode(this.data,c=>{this.isFetching=!1,a.tmp_selected=c;var d={};a.list.forEach(f=>{f.id==c.id&&(d=f)}),d.id?this.showZuiToast('\u8FD9\u5F20\u4F18\u60E0\u5238\u4F60\u5DF2\u7ECF\u6709\u5566~\u5DF2\u7ECF\u4E3A\u60A8\u9009\u4E2D'):a.list.unshift(c),this.setData({coupons:a})},c=>{this.isFetching=!1,a.error=c.msg,this.setData({coupons:a})}))):(a.error='\u8BF7\u8F93\u5165\u4F18\u60E0\u7801',void this.setData({coupons:a}))}};